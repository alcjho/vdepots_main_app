<style>
    .container{
        padding-top:20px;
    }

    .new-catalog{
 
    }

    .new-catalog a {
        color:#f0cc71;
        text-decoration:none;
    }

    .new-catalog a:hover{
        color:#d8b763;
        text-decoration:none;
    }

    .all-catalogs{
        border-left:1px solid #ddd;
        border-right:1px solid #ddd;
        border-bottom: 1px solid #ddd;
        border-radius: 10px;
        min-height: 150px;
        margin-bottom:40px;
        background: #d8b763;
        background: -moz-linear-gradient(top, #d8b763 0%, #f0e0b7 100%);
        background: -webkit-linear-gradient(top, #d8b763 0%, #f0e0b7 100%);
        background: linear-gradient(to bottom, #d8b763 0%, #f0e0b7 100%);
    }

    .all-catalogs table a{
        color:#008080;
        margin-left:5px;
        margin-right:5px;
    }

    .all-catalogs table .updsuccess{
        display:none;
        width:100%;
    }

     .all-catalogs table .updfailure{
        display:none;
         width:100%;
    }   

    .all-catalogs table .rmsuccess{
        display:none;
         width:100%;
    }   

     .all-catalogs table .rmfailure{
        display:none;
         width:100%;
    }          


    .all-catalogs table .actions{
        width:90px;
    }   
 
    .all-catalogs table .actions i{
        font-size:2.1em;
    }

    .all-catalogs table a:hover{
        color:#54aaaa;
    }

    .formcol{
        border-radius:20px;
        border: 1px solid #999;
    }

    .formcol h3{
        margin-top:-20px;
        padding:10px;
        color:#f0cc71;
    }   

    .new-catalog input,select,textarea{
        margin-bottom:20px;
        width:100%
    }

    .thead-dark th{
        color:#f0cc71!important;
        background-color:#008080 !important;
        font-size:1.2em;
    }

    .with-padding-5{
        padding:5px;
    }

    .with-padding-10{
        padding:10px;
    }

    .with-padding-20{
        padding:20px;
    } 

    .with-padding-30{
        padding:30px;
    }

    .with-margin-10{
        margin:10px;
    }

   .with-margin-20{
        margin:20px;
    }

   .with-margin-40{
        margin:40px;
    }

    .with-margin-btm{
        margin-bottom:40px;
    }

    .with-bg{
        background: #008080;
        background: -moz-linear-gradient(top, #008080 0%, #00CFCF 100%);
        background: -webkit-linear-gradient(top, #008080 0%, #00CFCF 100%);
        background: linear-gradient(to bottom, #008080 0%, #00CFCF 100%);
    }
</style>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="new-catalog"> 
                <form name="form-catalog" id="form-catalog" action="" method="post">
                    <div class="row">
                        <div class="col-md-12 itemlist">
                            <h2 style="margin-left:18px;text-align:center;display:inline-block;margin-top:16px">Available catalogs</h2>                            
                            <div class="all-catalogs">
                                <table class="table">
                                <thead class="thead thead-dark">
                                    <tr>
                                        <th>Name</th>
                                        <th>Capacity</th>
                                        <th>Trending</th>
                                        <th>Trendings/page</th>
                                        <th>Listing</th> 
                                        <th>Products/page</th>
                                        <th>Description</th>
                                        <th>&nbsp;</th>                    
                                    </tr> 
                                </thead>
                                <tbody>              
                                <%catalogs.forEach(function(cat){%>
                                    <tr>
                                        <td contenteditable="true"><%=cat.catname%></td>
                                        <td contenteditable="true"><%=cat.capacity%></td>
                                        <td contenteditable="true"><%=cat.trending%></td>
                                        <td contenteditable="true"><%=cat.trending_per_page%></td>
                                        <td contenteditable="true"><%=cat.listing%></td>
                                        <td contenteditable="true"><%=cat.listing_per_page%></td>
                                        <td contenteditable="true"><%=cat.description%></td>                       
                                        <td>
                                            <div class="actions">
                                                <a href="javascript:void(0)" onclick="updateCatalog(<%=id %>, this)"><i class="fas fa-pen-square"></i></a>
                                                <a href="javascript:void(0)" onclick="removeCatalog(<%=id%>, this)"><i class="fas fa-trash-alt"></i></a>
                                            </div>
                                        </td>
                                    </tr>
                                <%})%>
                                   <tr>
                                        <td colspan="8">
                                            <div class="alert alert-success  updsuccess"><%=update_success%></div>
                                            <div class="alert alert-danger updfailure"><%=update_failure%></div>
                                            <div class="alert alert-success rmsuccess"><%rm_success%></div>
                                            <div class="alert alert-danger rmfailure"><%rm_failure%></div>                                          
                                        </td>
                                    </tr>                                
                                </tbody> 
                                </table>
                            </div>
                        </div>                                           
                        <div class="col-md-12">
                            <h2 style="margin-left:18px;text-align:center;display:inline-block;margin-top:16px">Create new catalog</h2>
                            <a href="javascript:void(0)" onclick="$('form[name=form-catalog]').submit()"><i style="float:right" class="fas fa-save fa-4x" ></i></a>
                            <hr style="padding:0;margin:0">
                            <div class="row">                       
                                <fieldset class="col-md-6 with-padding-20">
                                    <div class="formcol with-bg with-padding-20 with-margin-btm">
                                        <h3>Catalog data</h3>
                                        <input class="form-control" type="text" name="catname" placeholder="Catalog title ex. Cars " tabindex="1">
                                        <input class="form-control" type="text" name="capacity" placeholder="Capacity of your catalog ex. 100" tabindex="2">
                                        <select name="catalog_type" class="form-control" tabindex="3">
                                            <option value="yes">Select a type for your catalog</option>
                                            <option value="product">product</option>
                                            <option value="service">service</option>
                                        </select>
                                        <select name="portfolios" class="form-control" tabindex="3">
                                            <option value="yes">Select a type for your catalog</option>
                                            <option value="product">product</option>
                                        </select>
                                        <textarea rows="5" class="form-control" name="description"></textarea>
                                    </div>

                                <%=locals.error%>                   

                                </fieldset>
                                <fieldset class="col-md-6 with-padding-20 ">
                                    <div class="formcol with-bg with-padding-20 with-margin-btm">
                                        <h3>Product Listing </h3>
                                        <select name="allow_listing" class="form-control" tabindex="4">
                                            <option value="yes">yes</option>
                                            <option value="no">no</option>
                                        </select>
                                        <label for="listing_size">listing size:</label><input class="form-control" type="text" name="listing_size" value="50" tabindex="5" disable>
                                        <label for="products_per_page">products per page:</label><input class="form-control" type="text" name="listing_per_page" value="20" tabindex="6" disable>
                                    </div>

                                   <div class="formcol with-bg with-padding-20">
                                        <h3>Most Valuable Products</h3>
                                        <select name="allow_trending" class="form-control" tabindex="4">
                                            <option value="yes">yes</option>
                                            <option value="no">no</option>
                                        </select>
                                        <label for="trending_size">trending size:</label><input class="form-control" type="text" name="trending_size" value="12" tabindex="5" disable>
                                        <label for="trending_per_page">trendings per page:</label><input class="form-control" type="text" name="trending_per_page" value="4" tabindex="6" disable>
                                    </div>                                    
                                </fieldset>
                            </div>
                            <hr style="margin:0;padding:0">
                            <a href="javascript:void(0)" onclick="$('form[name=form-catalog]').submit()"><i style="float:right" class="fas fa-save fa-4x"></i></a>                        
                        </div>                      
                    </div>                        
                </form>                      
            </div>
            <div class="alert alert-danger" style="display:<%=error_visible%>"><%=locals.error_msg%></div>
            <div class="alert alert-success" style="display:<%=success_visible%>"><%=locals.sucess_msg%></div>
        </div>
        
    </div>
 
</div>


<script>
    var source = axios.CancelToken.source();
    axios.interceptors.request.use(function (config) {
        config.cancelToken =  source.token;
        return config;
    }, function (error) {
        return Promise.reject(error);
    });

    axios.interceptors.request.use((config) => {
        dialog = confirm('are you sure you want to cancel this');
        if(!dialog){
            source.cancel(      );
        }
        return config;
    }, (error) => {
            // Do something with request error
            return Promise.reject(error);
        });
</script>


<script>
    async function updateCatalog(catid, elm){
        var table = $(elm).parents('table');
        row = [];

        $(elm).parents('tr').find('td').each(function(){
            row.push($(this).html());
        });

        var data = {'tablename' : table, 'rows' : row};
        
       try {
            const response = await axios.post('update/'+catid, {'catalog' : row}  );
            if(response.data.success){
                $('.alert').hide();
                $('.updsuccess').show();
            }else{
                $('.alert').hide();
                $('.updfailure').show();                
            }
            //updateTable(data, 2);
        }catch (error) {
            console.error(error);
        }
    }


    async function removeCatalog(catid, elm){
        var table = $(elm).parents('table');
        var row = $(elm).parents('tr');
        var data = {'tablename' : table, 'rows' : {row}};
        
       try {
            const response = await axios.get('remove/'+catid);
            if(response.data.success){
                $('.alert').hide();
                $('.rmsuccess').show();
                updateTable(data, 1);
            }else{
                $('.alert').hide();
                $('.rmfailure').show();                
            }
        }catch (error) {
            console.error(error);
        }
    }
</script>


<script>
    /**
     *Desc: remove rows from a table
     *
     **/
    function updateTable(json, action){
        switch(action){
            case 1:
                $(json.rows).each(function(key, obj){
                    $(obj.row).remove();
                });
            break;
            case 2:
                $(json.rows).each(function(key, obj){
                    $(obj.row).remove();
                });           
            break;           
        }
    }
</script>